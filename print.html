<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DiffSL</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-5f4161ac.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-e1e43fd6.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">DiffSL</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="diffsl-language"><a class="header" href="#diffsl-language">DiffSL Language</a></h1>
<p>The DSL is designed to be an easy and flexible language for specifying
ODE systems and is based on the idea that a ODE system can be specified by a set
of equations of the form:</p>
<p>$$
M(t) \frac{\mathrm{d}\mathbf{u}}{\mathrm{d}t} = F(\mathbf{u}, t)
$$</p>
<p>where \( \mathbf{u} \) is the vector of state variables and \( t \) is the time. The DSL
allows the user to specify the state vector \( \mathbf{u} \) and the RHS function \( F \).
Optionally, the user can also define the derivative of the state vector \( \mathrm{d}\mathbf{u}/\mathrm{d}t \)
and the mass matrix \( M \) as a function of \( \mathrm{d}\mathbf{u}/\mathrm{d}t \) (note that this function should be linear!).</p>
<p>The user is also free to define an arbitrary number of intermediate
scalars and vectors of the users that are required to calculate \( F \) and \( M \).</p>
<h2 id="a-simple-example"><a class="header" href="#a-simple-example">A Simple Example</a></h2>
<p>To illustrate the language, consider the following simple example of a logistic growth model:</p>
<p>$$
\frac{\mathrm{d}N}{\mathrm{d}t} = r N (1 - N/K)
$$</p>
<p>where \( N \) is the population, \( r \) is the growth rate, and \( K \) is the carrying capacity.</p>
<p>To specify this model in DiffSL, we can write:</p>
<pre><code>in = [r, k]
u_i {
  N = 0.0
}
F_i {
  r * N * (1 - N/k)
}
out_i {
  N
}
</code></pre>
<p>Here, we define the input parameters for our model as a vector <code>in</code> with the growth rate <code>r</code> and the carrying capacity <code>k</code>. We then define the state vector <code>u_i</code> with the population <code>N</code> initialized to <code>0.0</code>. Next, we define the RHS function <code>F_i</code> as the logistic growth equation. Finally, we define the output vector <code>out_i</code> with the population <code>N</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="defining-tensor-variables"><a class="header" href="#defining-tensor-variables">Defining tensor variables</a></h1>
<p>The DiffSL language only has a single type of variable, which is a n-dimensional tensor filled with double precision floating point numbers.
These tensors can be dense, sparse or diagonal, and the compiler will try to choose the representation that is most efficient, preferring diagonal and then sparse matrices over dense.</p>
<p>The simplest tensor is a 0th dimensional scalar. For example, to define a scalar variable \( k \) with value 1.0, we write:</p>
<pre><code>k { 1.0 }
</code></pre>
<p>Here <code>k</code> is the <em>label</em> for the tensor, which we can later use to refer to it in expressions. In the curly brackets we have one or more <em>elements</em> of the tensor,
and here <code>k</code> only has a single element, which is a constant value 1.</p>
<p>Lets now define a 1-dimensional vector variable \( \mathbf{v} \) with 3 elements:</p>
<pre><code>v_i {
 1.0,
 2.0,
 3.0,
}
</code></pre>
<p>The list of elements within a tensor are deliniated with a comma <code>,</code> and the trailing comma at the end of the list is optional.
Whitespace is ignored so you can also write this tensor all on the one line:</p>
<pre><code>v_i { 1.0, 2.0, 3.0 }
</code></pre>
<h2 id="subscripts"><a class="header" href="#subscripts">Subscripts</a></h2>
<p>In the previous vector <code>v_i</code>, the subscript <code>_i</code> indicates that this is a 1D vector. Each subscript is a single character,
and the number of subscripts indicates the number of dimensions of the tensor. You can use any character for the subscript,</p>
<pre><code>v_x { 1.0, 2.0, 3.0 }
w_a { 2.0, 3.0 }
v_i { 1.0, 2.0, 3.0, 4.0 }
</code></pre>
<h2 id="ranges"><a class="header" href="#ranges">Ranges</a></h2>
<p>Each element of a tensor can optionally give a <em>range</em> of index numbers, which is used by the compiler to determine the extent of each element.
This is useful when defining higher dimensional tensors, such as matrices. For example, to define a 2x3 matrix \( A \) with all elements set to <code>1.0</code>, we write:</p>
<pre><code>A_ij {
 (0:2, 0:3): 1.0,
}
</code></pre>
<p>Note the two subscript to indicate that this is a 2D tensor. The size of the
single element is given in the brackets, we have two ranges <code>0:2</code> and <code>0:3</code> that correspond to the two dimensions of the matrix.</p>
<p>Here is another example of a 4x2 matrix \( B \) with rows 0 to 2 set to <code>1.0</code> and rows 3 to 4 set to <code>2.0</code>:</p>
<pre><code>A_ij {
 (0:2, 0:3): 1.0,
 (3:4, 0:3): 2.0,
}
</code></pre>
<p>For specifying a single index, you can simply write the index number without the colon, for example to define a 3x3 identity matrix $I$:</p>
<pre><code>I_ij {
 (0, 0): 1.0,
 (1, 1): 1.0,
 (2, 2): 1.0,
}
</code></pre>
<p>Note that the compiler will automatically infer the size of the tensor from the ranges you provide, so you don’t need to specify the size of the tensor explicitly.
Since the maximum index in the range is 2, the compiler will infer that the size of the tensor is 3x3.</p>
<p>Notice also that we have not defined all the elements of the matrix, only the non-zero elements. The compiler will assume that all other elements are zero.</p>
<p>Finally, you can also use the <code>..</code> operator to specify a <em>diagonal</em> range of indices. For example, to define a 3x3 matrix \( D \) with the diagonal elements set to <code>1.0</code>:</p>
<pre><code>D_ij {
 (0..2, 0..2): 1.0,
}
</code></pre>
<h2 id="sparse-and-diagonal-matrices"><a class="header" href="#sparse-and-diagonal-matrices">Sparse and diagonal matrices</a></h2>
<p>We can automatically define a sparse matrix \( B \) by simply specifying the non-zero elements:</p>
<pre><code>B_ij {
 (0, 0): 1.0,
 (0, 1): 2.0,
 (1, 1): 3.0,
}
</code></pre>
<p>The compiler will infer that this is a 2x2 matrix, and will automatically represent it as a sparse matrix.
We can force the compiler to use a dense representation by specifying the zeros explicitly:</p>
<pre><code>B_ij {
 (0, 0): 1.0,
 (0, 1): 2.0,
 (1, 0): 0.0,
 (1, 1): 3.0,
}
</code></pre>
<p>As well as specifying a sparse matrix, we can also define a diagonal matrix by specifying the diagonal elements:</p>
<pre><code>D_ij {
 (0, 0): 1.0,
 (1, 1): 2.0,
 (2, 2): 3.0,
}
</code></pre>
<p>The compiler will infer that this is a 3x3 matrix, and will automatically represent it as a diagonal matrix.</p>
<h2 id="labels"><a class="header" href="#labels">Labels</a></h2>
<p>Each element of a tensor can optionally be given a name or <em>label</em> that can be used to refer to the element in expressions.</p>
<p>For example, to define a vector with two named elements:</p>
<pre><code>v_i {
 x = 1.0,
 y = 2.0,
}
</code></pre>
<p>Here we have defined a single tensor <code>v_i</code> with two named elements <code>x</code> and <code>y</code>. We can then refer to the individual elements in expressions, where they will act as if they were separate variables:</p>
<pre><code>v_i { x = 1.0, y = 2.0 }
w_i { 2 * y, 3 * x }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tensor-operations"><a class="header" href="#tensor-operations">Tensor Operations</a></h1>
<p>We can use standard algebraic operations on variables. To refer to previously
defined variables, we use the variable name, making sure to use the correct
subscript if it is a vector or tensor.</p>
<p>For example, to define a scalar variable \( a \) as the sum of two other scalar
variables \( b \) and \( c \), we write:</p>
<pre><code>b { 1.0 }
c { 2.0 }
a { b + c }
</code></pre>
<p>The scalar <code>a</code> will therefore be equal to 3.0.</p>
<p>To define a vector variable \( \mathbf{v} \) as the sum of two other vector
variables \( \mathbf{u} \) and \( \mathbf{w} \), we write:</p>
<pre><code>u_i { 1.0, 2.0 }
w_i { 3.0, 4.0 }
v_i { u_i + w_i }
</code></pre>
<p>Notice that the index of the vectors within the expression must match the index of the output vector <code>v_i</code>.
So if we defined <code>v_a</code> instead of <code>v_i</code>, the expression would be:</p>
<pre><code>v_a { u_a + w_a }
</code></pre>
<h2 id="translations"><a class="header" href="#translations">Translations</a></h2>
<p>For higher-dimensional tensors, the order of the indices in the expression relative to the output tensor is important.</p>
<p>For example, we can use the indices to define a translation of a matrix. Here we define a new matrix \( C \) that is the sum of \( A \) and \( B^T \),
where \( B^T \) is the transpose of \( B \)</p>
<pre><code>C_ij { A_ij + B_ji }
</code></pre>
<p>Notice that the indices of \( B^T \) are reversed in the expression compared to the output tensor \( C \), indicating that we are indexing the rows of \( B \) with <code>j</code> and the columns with <code>i</code> when we calculate the <code>(i, j)</code> element of \( C \).</p>
<h2 id="broadcasting"><a class="header" href="#broadcasting">Broadcasting</a></h2>
<p>Broadcasting is supported in the language, so you can perform element-wise operations on tensors of different shapes. For example, the following will define a new vector \( \mathbf{d} \) that is the sum of \( \mathbf{a} \) and a scalar \( k \):</p>
<pre><code>a_i { 1.0, 2.0 }
k { 3.0 }
d_i { a_i + k }
</code></pre>
<p>Here the scalar \( k \) is broadcast to the same shape as \( \mathbf{a} \) before the addition. The output vector \( \mathbf{d} \) will be \( [4.0, 5.0] \).</p>
<p>DiffSL uses the same broadcasting rules as NumPy, and you can read more about this in the <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html">NumPy documentation</a>.</p>
<h2 id="contractions"><a class="header" href="#contractions">Contractions</a></h2>
<p>The DiffSL indexing notation allows for tensor contractions, which are operations that sum over one or more indices.
The rule used is that any indices that do not appear in the output tensor will be summed over.</p>
<p>For example, the following defines a new vector \( \mathbf{v} \) that is the sum of the rows of a matrix \( A \):</p>
<pre><code>v_i { A_ij }
</code></pre>
<p>The above expression sums over the <code>j</code> index of the matrix <code>A</code>, resulting in a vector <code>v</code> where each element <code>v_i</code> is the sum of the elements in the <code>i</code>-th row of <code>A</code>.
At the moment only 2d to 1d contractions are supported in order to enable matrix-vector multiplication, please open an issue if you need more general contraction support.</p>
<p>We can also define a matrix-vector multiplication, the following will define a new vector \( \mathbf{v} \) that is
the result of a matrix-vector multiplication of a matrix \( A \) and a vector \( \mathbf{u} \):</p>
<pre><code>v_i { A_ij * u_j }
</code></pre>
<p>This operation is actually a combination of a broadcast <code>A_ij * u_j</code>, followed by a contraction over the <code>j</code> index,
the <code>A_ij * u_j</code> expression broadcasts the vector <code>u</code> to the same shape as <code>A</code>, forming a new 2D tensor, and
the output vector <code>v_i</code> implicitly sums over the missing <code>j</code> index to form the final output vector.
To illustrate this further, lets manually break this matrix-vector multiplication into two steps using an intermediary tensor <code>M_ij</code>:</p>
<pre><code>M_ij { A_ij * u_j }
v_i { M_ij }
</code></pre>
<p>The first step calculates the element-wise product of <code>A</code> and <code>u</code> using broadcasting into the 2D tensor <code>M</code>, and the second step uses a contraction to sum over the <code>j</code> index to form the output vector <code>v</code>.</p>
<h2 id="indexing"><a class="header" href="#indexing">Indexing</a></h2>
<p>Indexing a 1D dense tensor (vector) is supported using square brackets. You can use either single indexing to extract a single element, or range indexing to extract a sub-vector.</p>
<p>For example, to extract the third element of a vector \( \mathbf{a} \) and assign it to a scalar \( r \), you can write:</p>
<pre><code>a_i { 0.0, 1.0, 2.0, 3.0 }
r { a_i[2] }
</code></pre>
<p>To extract a sub-vector containing the second and third elements of \( \mathbf{a} \) and assign it to a new vector \( \mathbf{r} \), you can write:</p>
<pre><code>a_i { 0.0, 1.0, 2.0, 3.0 }
r_i { a_i[1:3] }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="defining-a-system-of-odes"><a class="header" href="#defining-a-system-of-odes">Defining a system of ODEs</a></h1>
<p>The primary goal of the DiffSL language is to define a system of ODEs in the following form:</p>
<p>$$
\begin{align*}
M(t) \frac{\mathrm{d}\mathbf{u}}{\mathrm{d}t} &amp;= F(\mathbf{u}, t) \\
\mathbf{u}(0) &amp;= \mathbf{u}_0
\end{align*}
$$</p>
<p>where \( \mathbf{u} \) is the vector of state variables, \( \mathbf{u}_0 \) is the initial condition, \( F \) is the RHS function, and \( M \) is the mass matrix.
The DSL allows the user to specify the state vector \( \mathbf{u} \) and the RHS function \( F \).</p>
<p>Optionally, the user can also define the derivative of the state vector \( \mathrm{d}\mathbf{u}/\mathrm{d}t \) and the mass matrix \( M \) as a function of \( \mathrm{d}\mathbf{u}/\mathrm{d}t \)
(note that this function should be linear!).
The user is also free to define an arbitrary number of intermediate tensors that are required to calculate \( F \) and \( M \).</p>
<h2 id="defining-state-variables"><a class="header" href="#defining-state-variables">Defining state variables</a></h2>
<p>To define the state variables \(\mathbf{u} \), we create a special
vector variable <code>u_i</code>. Note the particular name <code>u</code> is used to indicate that this
is the state vector.</p>
<p>The values that we use for <code>u_i</code> are the initial values of the state variables
at \( t=0 \), so an initial condition \( \mathbf{u}(t=0) = [x(0), y(0), z(0)] = [1, 0, 0] \) is defined as:</p>
<pre><code>u_i {
  x = 1,
  y = 0,
  z = 0,
}
</code></pre>
<p>Since we will often use the individual elements of the state vector in the RHS function, it is useful to define them as separate variables as well.</p>
<p>We can optionally define the time derivatives of the state variables,
\( \mathbf{\dot{u}} \) as well:</p>
<pre><code>dudt_i {
  dxdt = 1,
  dydt = 0,
  dzdt = 0,
}
</code></pre>
<p>Here the initial values of the time derivatives are given.
In many cases any values can be given here as the time derivatives of the state variables are calculated from the RHS.
However, if there are any algebraic variables in the equations then these values can be used
used as a starting point to calculate a set of consistent initial values for the
state variables.</p>
<p>Note that there is no need to define <code>dudt</code> if you do not define a mass matrix \( M \).</p>
<h2 id="defining-the-ode-system-equations"><a class="header" href="#defining-the-ode-system-equations">Defining the ODE system equations</a></h2>
<p>We now define the right-hand-side  function \( F \) that we want to solve, using the
variables that we have defined earlier. We do this by defining a vector variable
<code>F_i</code> that corresponds to the RHS of the equations.</p>
<p>For example, to define a simple system of ODEs:</p>
<p>$$
\begin{align*}
\frac{dx}{dt} &amp;= y \\
\frac{dy}{dt} &amp;= -x \\
x(0) &amp;= 1 \\
y(0) &amp;= 0 \\
\end{align*}
$$</p>
<p>We write:</p>
<pre><code>u_i { x = 1, y = 0 }
F_i { y, -x }
</code></pre>
<h2 id="defining-the-mass-matrix"><a class="header" href="#defining-the-mass-matrix">Defining the mass matrix</a></h2>
<p>We can also define a mass matrix \( M \) by defining a vector variable <code>M_i</code> which is the product of the mass matrix with the time derivative of the state vector \( M \mathbf{\dot{u}} \).
This is optional, and if not defined, the mass matrix is assumed to be the identity
matrix.</p>
<p>Notice that we are defining a vector variable <code>M_i</code>, which is the LHS of the ODE equations \( M \mathbf{\dot{u}} \), and <strong>not</strong> the mass matrix itself.</p>
<p>For example, lets define a simple DAE system using a singular mass matrix with a
zero on the diagonal:</p>
<p>$$
\begin{align*}
\frac{\mathrm{d}x}{\mathrm{d}t} &amp;= x \\
0 &amp;= y-x \\
x(0) &amp;= 1 \\
y(0) &amp;= 0 \\
\end{align*}
$$</p>
<p>We write:</p>
<pre><code>u_i {
 x = 1,
 y = 0,
}
dudt_i {
 dxdt = 0,
 dydt = 1,
}
M_i {
 dxdt,
 0,
}
F_i {
 x,
 y-x,
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="inputs--outputs"><a class="header" href="#inputs--outputs">Inputs &amp; Outputs</a></h1>
<p>Often it is useful to parameterize the system of equations using a set of input parameters. It is also useful to be able to extract certain variables from the system for further analysis.
In this section we will show how to specify inputs and outputs in the DiffSL language.</p>
<h2 id="specifying-inputs"><a class="header" href="#specifying-inputs">Specifying inputs</a></h2>
<p>We can override the values of any scalar variables by specifying them as input
variables.  To do this, we add a line at the top of the code to specify that
these are input variables:</p>
<pre><code>in = [k]
k { 1.0 }
u { 0.1 }
F { k * u }
</code></pre>
<p>Here we have specified a single input parameter <code>k</code> that is used in the RHS function <code>F</code>.
The value of <code>k</code> is set to <code>1.0</code> in the code, but this value is only a default, and can be overridden by passing in a value at solve time.</p>
<p>We can use input parameters anywhere in the code, including in the definition of other input parameters.</p>
<pre><code>in = [k]
k { 1.0 }
g { 2 * k }
F { g * u }
</code></pre>
<p>or in the intial conditions of the state variables:</p>
<pre><code>in = [k]
k { 1.0 }
u_i {
  x = k,
}
F { u }
</code></pre>
<h2 id="specifying-outputs"><a class="header" href="#specifying-outputs">Specifying outputs</a></h2>
<p>We can also specify the outputs of the system. These might be the state
variables themselves, or they might be other variables that are calculated from
the state variables.</p>
<p>Here is an example where we simply output the elements of the state vector:</p>
<pre><code>u_i {
  x = 1.0,
  y = 2.0,
  z = 3.0,
}
out_i { x, y, z }
</code></pre>
<p>or we can derive additional outputs from the state variables:</p>
<pre><code>u_i {
  x = 1.0,
  y = 2.0,
  z = 3.0,
}
out { x + y + z }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="pre-defined-functions"><a class="header" href="#pre-defined-functions">Pre-defined functions</a></h1>
<p>The DiffSL supports the following mathematical functions that can be used in an expression:</p>
<ul>
<li><code>pow(x, y)</code> - x raised to the power of y</li>
<li><code>sin(x)</code> - sine of x</li>
<li><code>cos(x)</code> - cosine of x</li>
<li><code>tan(x)</code> - tangent of x</li>
<li><code>exp(x)</code> - exponential of x</li>
<li><code>log(x)</code> - natural logarithm of x</li>
<li><code>sqrt(x)</code> - square root of x</li>
<li><code>abs(x)</code> - absolute value of x</li>
<li><code>sigmoid(x)</code> - sigmoid function of x</li>
<li><code>heaviside(x)</code> - Heaviside step function of x</li>
</ul>
<p>You can use these functions as part of an expression in the DSL. For example, to define a variable <code>a</code> that is the sine of another variable <code>b</code>, you can write:</p>
<pre><code>b { 1.0 }
a { sin(b) }
</code></pre>
<h1 id="pre-defined-variables"><a class="header" href="#pre-defined-variables">Pre-defined variables</a></h1>
<p>The only predefined variable is the scalar <code>t</code> which is the current time, this allows the equations to be written as functions of time. For example</p>
<pre><code>F_i {
  t + sin(t)
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>


    </div>
    </body>
</html>
